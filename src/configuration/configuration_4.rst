.. =========================================================
.. LeoFS documentation
.. Copyright (c) 2012-2015 Rakuten, Inc.
.. http://leo-project.net/
.. =========================================================

.. index::
    SNMP

SNMPA Setup
-----------

Each LeoFS node provides a built in SNMP server which allows to connect external systems, such as |Nagios| and |Zabbix|. You can retrieve various statistics as follows:

.. index::
   pair: SNMP; LeoFS Manager

LeoFS Manager
^^^^^^^^^^^^^^

SNMPA Properties
"""""""""""""""""

\

+------------------+------------------------------------+
| Property         | Value / Range                      |
+==================+====================================+
| Port             | 4020 .. 4022                       |
+------------------+------------------------------------+
| Branch           | 1.3.6.1.4.1.35450.15               |
+------------------+------------------------------------+
| snmpa_manager_0  | Port: 4020                         |
+------------------+------------------------------------+
| snmpa_manager_1  | Port: 4021                         |
+------------------+------------------------------------+
| snmpa_manager_2  | Port: 4022                         |
+------------------+------------------------------------+

SNMPA Items
""""""""""""

\

+------------------+------------------------------------+
| Branch Number    | Description                        |
+==================+====================================+
| 1                | Node name                          |
+------------------+------------------------------------+
| **1-min averages**                                    |
+------------------+------------------------------------+
| 2                | # of processes                     |
+------------------+------------------------------------+
| 3                | Total memory usage                 |
+------------------+------------------------------------+
| 4                | System memory usage                |
+------------------+------------------------------------+
| 5                | Processes memory usage             |
+------------------+------------------------------------+
| 6                | ETS memory usage                   |
+------------------+------------------------------------+
| **5-min averages**                                    |
+------------------+------------------------------------+
| 7                | # of processes                     |
+------------------+------------------------------------+
| 8                | Total memory usage                 |
+------------------+------------------------------------+
| 9                | System memory usage                |
+------------------+------------------------------------+
| 10               | Processes memory usage             |
+------------------+------------------------------------+
| 11               | ETS memory usage                   |
+------------------+------------------------------------+
| **allocated memmory**                                 |
+------------------+------------------------------------+
| 12               | Used/allocated memory for 1min     |
+------------------+------------------------------------+
| 13               | Allocated memory for 1min          |
+------------------+------------------------------------+
| 14               | Used/allocated memory for 5min     |
+------------------+------------------------------------+
| 15               | Allocated memory for 5min          |
+------------------+------------------------------------+



Check the configuration
""""""""""""""""""""""""

::

    $ snmpwalk -v 2c -c public 127.0.0.1:4020 .1.3.6.1.4.1.35450
    SNMPv2-SMI::enterprises.35450.15.1.0 = STRING: "manager_0@127.0.0.1"
    SNMPv2-SMI::enterprises.35450.15.2.0 = Gauge32: 123
    SNMPv2-SMI::enterprises.35450.15.3.0 = Gauge32: 30289989
    SNMPv2-SMI::enterprises.35450.15.4.0 = Gauge32: 24256857
    SNMPv2-SMI::enterprises.35450.15.5.0 = Gauge32: 6033132
    SNMPv2-SMI::enterprises.35450.15.6.0 = Gauge32: 1914017
    SNMPv2-SMI::enterprises.35450.15.7.0 = Gauge32: 123
    SNMPv2-SMI::enterprises.35450.15.8.0 = Gauge32: 30309552
    SNMPv2-SMI::enterprises.35450.15.9.0 = Gauge32: 24278377
    SNMPv2-SMI::enterprises.35450.15.10.0 = Gauge32: 6031175
    SNMPv2-SMI::enterprises.35450.15.11.0 = Gauge32: 1935758
    SNMPv2-SMI::enterprises.35450.15.12.0 = Gauge32: 75
    SNMPv2-SMI::enterprises.35450.15.13.0 = Gauge32: 84635402
    SNMPv2-SMI::enterprises.35450.15.14.0 = Gauge32: 78
    SNMPv2-SMI::enterprises.35450.15.15.0 = Gauge32: 88735915


.. index::
   pair: SNMP; LeoFS Storage

LeoFS Storage
^^^^^^^^^^^^^^

SNMPA Properties
"""""""""""""""""

\

+------------------+------------------------------------+
| Property         | Value / Range                      |
+==================+====================================+
| Port             | 4010 .. 4013                       |
+------------------+------------------------------------+
| Branch           | 1.3.6.1.4.1.35450                  |
+------------------+------------------------------------+
| snmpa_storage_0  | Port: 4010                         |
+------------------+------------------------------------+
| snmpa_storage_1  | Port: 4011                         |
+------------------+------------------------------------+
| snmpa_storage_2  | Port: 4012                         |
+------------------+------------------------------------+
| snmpa_storage_3  | Port: 4013                         |
+------------------+------------------------------------+

SNMPA Items
""""""""""""

\

+------------------+------------------------------------+
| Branch Number    | Description                        |
+==================+====================================+
| 1                | Node name                          |
+------------------+------------------------------------+
| **VM-related values (1min averages)**                 |
+------------------+------------------------------------+
| 2                | # of processes                     |
+------------------+------------------------------------+
| 3                | Total memory usage                 |
+------------------+------------------------------------+
| 4                | System memory usage                |
+------------------+------------------------------------+
| 5                | Processes memory usage             |
+------------------+------------------------------------+
| 6                | ETS memory usage                   |
+------------------+------------------------------------+
| **VM-related values (5min averages)**                 |
+------------------+------------------------------------+
| 7                | # of processes                     |
+------------------+------------------------------------+
| 8                | Total memory usage                 |
+------------------+------------------------------------+
| 9                | System memory usage                |
+------------------+------------------------------------+
| 10               | Processes memory usage             |
+------------------+------------------------------------+
| 11               | ETS memory usage                   |
+------------------+------------------------------------+
| **Request counter (for 1min)**                        |
+------------------+------------------------------------+
| 12               | # of WRITEs                        |
+------------------+------------------------------------+
| 13               | # of READs                         |
+------------------+------------------------------------+
| 14               | # of DELETEs                       |
+------------------+------------------------------------+
| **Request counter (for 5min)**                        |
+------------------+------------------------------------+
| 15               | # of WRITEs                        |
+------------------+------------------------------------+
| 16               | # of READs                         |
+------------------+------------------------------------+
| 17               | # of DELETEs                       |
+------------------+------------------------------------+
| **# of objects**                                      |
+------------------+------------------------------------+
| 18               | # of active objects                |
+------------------+------------------------------------+
| 19               | Total objects                      |
+------------------+------------------------------------+
| 20               | Total size of active objects       |
+------------------+------------------------------------+
| 21               | Total size                         |
+------------------+------------------------------------+
| **MQ-related properties**                             |
+------------------+------------------------------------+
| 22               | # of replication messages          |
+------------------+------------------------------------+
| 23               | # of sync-vnode messages           |
+------------------+------------------------------------+
| 24               | # of rebalance messages            |
+------------------+------------------------------------+
| **allocated memmory**                                 |
+------------------+------------------------------------+
| 31               | Used/allocated memory for 1min     |
+------------------+------------------------------------+
| 32               | Allocated memory for 1min          |
+------------------+------------------------------------+
| 33               | Used/allocated memory for 5min     |
+------------------+------------------------------------+
| 34               | Allocated memory for 5min          |
+------------------+------------------------------------+


Check the configuration
""""""""""""""""""""""""

::

    $ snmpwalk -v 2c -c public 127.0.0.1:4010 .1.3.6.1.4.1.35450
    SNMPv2-SMI::enterprises.35450.34.1.0 = STRING: "storage_0@127.0.0.1"
    SNMPv2-SMI::enterprises.35450.34.2.0 = Gauge32: 227
    SNMPv2-SMI::enterprises.35450.34.3.0 = Gauge32: 33165164
    SNMPv2-SMI::enterprises.35450.34.4.0 = Gauge32: 24504020
    SNMPv2-SMI::enterprises.35450.34.5.0 = Gauge32: 8661144
    SNMPv2-SMI::enterprises.35450.34.6.0 = Gauge32: 1952903
    SNMPv2-SMI::enterprises.35450.34.7.0 = Gauge32: 227
    SNMPv2-SMI::enterprises.35450.34.8.0 = Gauge32: 33379629
    SNMPv2-SMI::enterprises.35450.34.9.0 = Gauge32: 24493694
    SNMPv2-SMI::enterprises.35450.34.10.0 = Gauge32: 8885935
    SNMPv2-SMI::enterprises.35450.34.11.0 = Gauge32: 1941680
    SNMPv2-SMI::enterprises.35450.34.12.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.13.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.14.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.15.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.16.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.17.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.18.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.19.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.20.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.21.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.22.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.23.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.24.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.31.0 = Gauge32: 75
    SNMPv2-SMI::enterprises.35450.34.32.0 = Gauge32: 84635402
    SNMPv2-SMI::enterprises.35450.34.33.0 = Gauge32: 78
    SNMPv2-SMI::enterprises.35450.34.34.0 = Gauge32: 88735915

.. index::
   pair: SNMP; LeoFS Gatewat

LeoFS Gateway
^^^^^^^^^^^^^^

SNMPA Properties
"""""""""""""""""

\

+------------------+------------------------------------+
| Item             | Value / Range                      |
+==================+====================================+
| Port             | 4000 .. 4001                       |
+------------------+------------------------------------+
| Branch           | 1.3.6.1.4.1.35450                  |
+------------------+------------------------------------+
| snmpa_gateway_0  | Port: 4000                         |
+------------------+------------------------------------+
| snmpa_gateway_1  | Port: 4001                         |
+------------------+------------------------------------+

SNMPA Items
""""""""""""

\

+------------------+------------------------------------+
| Branch Number    | Description                        |
+==================+====================================+
| 1                | Node name                          |
+------------------+------------------------------------+
| **VM-related values (1-min averages)**                |
+------------------+------------------------------------+
| 2                | # of processes                     |
+------------------+------------------------------------+
| 3                | Total memory usage                 |
+------------------+------------------------------------+
| 4                | System memory usage                |
+------------------+------------------------------------+
| 5                | Processes memory usage             |
+------------------+------------------------------------+
| 6                | ETS memory usage                   |
+------------------+------------------------------------+
| **VM-related values (5-min averages)**                |
+------------------+------------------------------------+
| 7                | # of processes                     |
+------------------+------------------------------------+
| 8                | Total memory usage                 |
+------------------+------------------------------------+
| 9                | System memory usage                |
+------------------+------------------------------------+
| 10               | Processes memory usage             |
+------------------+------------------------------------+
| 11               | ETS memory usage                   |
+------------------+------------------------------------+
| **Request counter (for 1min)**                        |
+------------------+------------------------------------+
| 12               | # of WRITEs                        |
+------------------+------------------------------------+
| 13               | # of READs                         |
+------------------+------------------------------------+
| 14               | # of DELETEs                       |
+------------------+------------------------------------+
| **Request counter (for 5min)**                        |
+------------------+------------------------------------+
| 15               | # of WRITEs                        |
+------------------+------------------------------------+
| 16               | # of READs                         |
+------------------+------------------------------------+
| 17               | # of DELETEs                       |
+------------------+------------------------------------+
| **Cache-related properties**                          |
+------------------+------------------------------------+
| 18               | Count of cache-hit                 |
+------------------+------------------------------------+
| 19               | Count of cache-miss                |
+------------------+------------------------------------+
| 20               | Total of files (objects)           |
+------------------+------------------------------------+
| 21               | Total cached size                  |
+------------------+------------------------------------+
| **allocated memmory**                                 |
+------------------+------------------------------------+
| 31               | Used/allocated memory for 1min     |
+------------------+------------------------------------+
| 32               | Allocated memory for 1min          |
+------------------+------------------------------------+
| 33               | Used/allocated memory for 5min     |
+------------------+------------------------------------+
| 34               | Allocated memory for 5min          |
+------------------+------------------------------------+

Check the configuration
""""""""""""""""""""""""

::

    $ snmpwalk -v 2c -c public 127.0.0.1:4000 .1.3.6.1.4.1.35450
    SNMPv2-SMI::enterprises.35450.34.1.0 = STRING: "gateway_0@127.0.0.1"
    SNMPv2-SMI::enterprises.35450.34.2.0 = Gauge32: 279
    SNMPv2-SMI::enterprises.35450.34.3.0 = Gauge32: 45266128
    SNMPv2-SMI::enterprises.35450.34.4.0 = Gauge32: 36653905
    SNMPv2-SMI::enterprises.35450.34.5.0 = Gauge32: 8612223
    SNMPv2-SMI::enterprises.35450.34.6.0 = Gauge32: 2276519
    SNMPv2-SMI::enterprises.35450.34.7.0 = Gauge32: 279
    SNMPv2-SMI::enterprises.35450.34.8.0 = Gauge32: 45157433
    SNMPv2-SMI::enterprises.35450.34.9.0 = Gauge32: 36385227
    SNMPv2-SMI::enterprises.35450.34.10.0 = Gauge32: 8772210
    SNMPv2-SMI::enterprises.35450.34.11.0 = Gauge32: 2261105
    SNMPv2-SMI::enterprises.35450.34.12.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.13.0 = Gauge32: 13
    SNMPv2-SMI::enterprises.35450.34.14.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.15.0 = Gauge32: 3
    SNMPv2-SMI::enterprises.35450.34.16.0 = Gauge32: 24
    SNMPv2-SMI::enterprises.35450.34.17.0 = Gauge32: 0
    SNMPv2-SMI::enterprises.35450.34.18.0 = Gauge32: 21
    SNMPv2-SMI::enterprises.35450.34.19.0 = Gauge32: 39
    SNMPv2-SMI::enterprises.35450.34.20.0 = Gauge32: 3
    SNMPv2-SMI::enterprises.35450.34.21.0 = Gauge32: 565700
    SNMPv2-SMI::enterprises.35450.34.31.0 = Gauge32: 75
    SNMPv2-SMI::enterprises.35450.34.32.0 = Gauge32: 84635402
    SNMPv2-SMI::enterprises.35450.34.33.0 = Gauge32: 78
    SNMPv2-SMI::enterprises.35450.34.34.0 = Gauge32: 88735915



.. |Nagios| raw:: html

   <a href="http://www.nagios.org/" target="_blank">Nagios</a>

.. |Zabbix| raw:: html

   <a href="http://www.zabbix.com/" target="_blank">Zabbix</a>

