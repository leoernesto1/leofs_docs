.. =========================================================
.. LeoFS documentation
.. Copyright (c) 2012-2015 Rakuten, Inc.
.. http://leo-project.net/
.. =========================================================


leofs-adm Command Line
======================

|leofs-adm| makes administrative operations of LeoFS very easy.

+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Shell**                                                                            | **Description**                                                                                      |
+======================================================================================+======================================================================================================+
| **General Commands**                                                                                                                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`status <status-command>` [<node>]                                    | * Retrieve status of every node (default)                                                            |
|                                                                                      | * Retrieve status of the specified node                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`whereis <whereis-command>` <file-path>                               | * Retrieve an assigned object by the file-path                                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **LeoFS Storage Cluster Operation**                                                                                                                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`detach <detach-command>` <storage-node>                              | * Remove the storage node in the LeoFS storage cluster                                               |
|                                                                                      | * Current status: ``running`` | ``stop``                                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`suspend <suspend-command>` <storage-node>                            | * Suspend a storage node for maintenance                                                             |
|                                                                                      | * This command does NOT detach the node from the storage cluster                                     |
|                                                                                      | * While suspending, it rejects any requests                                                          |
|                                                                                      | * Current status: ``running``                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`resume <resume-command>` <storage-node>                              | * Resume a storage node for finished maintenance                                                     |
|                                                                                      | * Current status: ``suspended`` | ``restarted``                                                      |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`start <start-command>`                                               | * Start LeoFS after distributing the RING from LeoFS Manager to LeoFS Storage and LeoFS Gateway      |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`rebalance <rebalance-command>`                                       | * Commit detached and attached nodes to join the cluster                                             |
|                                                                                      | * Rebalance objects in the cluster based on the updated cluster topology                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **LeoFS Storage MQ Operation**  [1.2.0-]                                                                                                                                                    |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`mq-stats <mq-stats-command>` <storage-node>                          | * See the statuses of message queues used in LeoFS Storage                                           |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`mq-suspend <mq-suspend-command>` <storage-node> <mq-id>              | * Suspend a process consuming a message queue                                                        |
|                                                                                      | * Active message queues only can be suspended                                                        |
|                                                                                      | * While suspending, no messages are consumed                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`mq-resume <mq-resume-command>` <storage-node> <mq-id>                | * Resume a process consuming a message queue                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Recover Commands**                                                                                                                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`recover-file <recover-file-command>` <file-path>                     | * Recover an inconsistent object specified by the file-path                                          |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`recover-node <recover-node-command>` <storage-node>                  | * Recover all inconsistent objects in the specified node                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`recover-ring <recover-ring-command>` <storage-node>                  | * Recover rings of the specified node                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`recover-cluster <recover-cluster-command>` <cluster-id>              | * ``v1.0.0-`` Recover all inconsistent objects in the specified cluster                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Data Compaction Commands**                                                                                                                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`compact-start <compact-start>` <storage-node> (all|<num-of-targets>) | * Remove unnecessary objects from the node                                                           |
| [<num-of-compaction-proc>]                                                           | * ``num-of-targets``: It controls the number of containers in parallel                               |
|                                                                                      | * ``num-of-compaction-procs``: It controls the number of procs to execute the compaction in parallel |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`compact-suspend <compact-suspend>` <storage-node>                    | * Suspend the compaction                                                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`compact-resume <compact-resume>` <storage-node>                      | * Resume the compaction                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`compact-status <compact-status>` <storage-node>                      | * See the current compaction status                                                                  |
|                                                                                      | * Compaction's status: ``idle``, ``running``, ``suspend``                                            |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`diagnose-start <diagnose-start>` <storage-node>                      | * ``v1.1.5-`` Diagnose data of a target storage node                                                 |
|                                                                                      |                                                                                                      |
|                                                                                      |                                                                                                      |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Disk Usage**                                                                                                                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`du <du>` <storage-node>                                              | * See the current disk usages                                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`du detail <du-detail>` <storage-node>                                | * See the current disk usages in the details                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **LeoFS Gateway Operation**                                                                                                                                                                 |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`purge-cache <purge>` <file-path>                                     | * Remove the cache from each LeoFS gateway                                                           |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`remove-gateway <remove>` <gateway-node>                              | * Remove the LeoFS Gateway node, which is already stopped                                            |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **LeoFS Manager Maintenance**                                                                                                                                                               |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`backup-mnesia <backup-mnesia>` <backup-filepath>                     | * Copy LeoFS's Manager data to the filepath                                                          |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`restore-mnesia <restore-mnesia>` <backup-filepath>                   | * Restore LeoFS's Manager data from the backup file                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`update-managers <update-managers>` <manager-master> <manager-slave>  | * Update LeoFS Manager nodes                                                                         |
|                                                                                      | * Destribute the new LeoFS Manager nodes to LeoFS Storage and Gateway                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`dump-ring <dump-ring>` (<manager-node>|<storage-node>|<gateway-node>)| * Dump the ring data to the local disk                                                               |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **S3-API Commands - User**                                                                                                                                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`create-user <create-user>` <user-id> <password>                      | * Register the new user                                                                              |
|                                                                                      | * Generate an S3 key pair (AccessKeyID and SecretAccessKey)                                          |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`delete-user <delete-user>` <user-id>                                 | * Remove the user                                                                                    |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`get-users <get-users>`                                               | * Retrieve the list of users                                                                         |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`update-user-role <update-user-role>`                                 | * Update the user's role                                                                             |
|                                                                                      | * Currently, we are supporting two kinds of roles                                                    |
|                                                                                      | * 1: General user, 9: Administrator                                                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **S3-API Commands - Endpoint**                                                                                                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`add-endpoint <add-endpoint>` <endpoint>                              | * Register a new S3 Endpoint                                                                         |
|                                                                                      | * LeoFS' domains are ruled by :ref:`this rule <s3-path-label>`                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`delete-endpoint <delete-endpoint>` <endpoint>                        | * Remove the endpoint                                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`get-endpoints <get-endpoints>`                                       | * Retrieve the list of endpoints                                                                     |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **S3-API Commands - Bucket**                                                                                                                                                                |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`add-bucket <add-bucket>` <bucket> <access-key-id>                    | * Create the new bucket                                                                              |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`delete-bucket <delete-bucket>` <bucket> <access-key-id>              | * Remove the bucket and all files stored in the bucket                                               |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`get-buckets <get-buckets>`                                           | * Retrieve the list of the buckets registered                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`get-bucket <get-bucket>` <access-key-id>                             | * Retrieve the list of the buckets owned by the specified user                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`chown-bucket <chown-bucket>` <bucket> <access-key-id>                | * ``v0.16.5-`` Change the owner of the bucket                                                        |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`update-acl <update-acl>` <bucket> <access-key-id>                    | * ``v0.16.0-`` Update the ACL (Access Control List) for the bucket                                   |
| (private | public-read | public-read-write)                                          | * Available ACL list:                                                                                |
|                                                                                      |      * ``private (default)`` : No one except the owner has access rights                             |
|                                                                                      |      * ``public-read``       : All users have READ access                                            |
|                                                                                      |      * ``public-read-write`` : All users have READ and WRITE access                                  |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`set-redundancy-method <set-redundancy-method>`                       | * ``v1.4.0-`` Set redundancy method of the bucket                                                    |
| <bucket> <access-key-id> (copy | erasure-code)                                       | * Both ``object copy`` and ``erasure code`` are supported                                            |
| [<number-of-data-chunks>] [<number-of-conding-chunks>]                               | * erasure-code:                                                                                      |
|                                                                                      |      * number-of-data-chunks: The number of chunks in which the original object is divided           |
|                                                                                      |      * number-of-coding-chunks: The number of additional chunks computed by the functions            |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| **Multi Data Center Operation**                                                                                                                                                             |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`join-cluster <join-cluster>` <manager-master> <manager-slave>        | ``1.0.0-`` Begin to communicate between the local cluster and the remote cluster                     |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`remove-cluster <remove-cluster>` <manager-master> <manager-slave>    | ``1.0.0-`` Terminate to communicate between the local cluster and the remote cluster                 |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+
| leofs-adm :ref:`cluster-status <cluster-status>`                                     | ``1.0.0-`` See the current state of cluster(s)                                                       |
+--------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------+



.. |leofs-adm| raw:: html

   <a href="https://github.com/leo-project/leofs/blob/master/leofs-adm" target="_blank">leofs-adm</a>
